<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/>
<meta name="viewport" content="width=device-width"/>
  <title>eNGE</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="css/style.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
<link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"
/>

</head>
<body onload="init();">


  <canvas id="display"></canvas>

  <!-- Bot√£o de configura√ß√£o -->
  <button id="settingsButton" type="button">
    <img src="images/ic_controller_m1_button.png" alt="Configura√ß√µes" width="30">
  </button><div id="virtualGamepad">
  
  <!-- üß© Bot√µes superiores -->
  <div class="shoulders">
    <div class="left-shoulder">
      <button id="l2" class="btn-shoulder">L2</button>
      <button id="l1" class="btn-shoulder">L1</button>
    </div>
    <div class="right-shoulder">
      <button id="r1" class="btn-shoulder">R1</button>
      <button id="r2" class="btn-shoulder">R2</button>
    </div>
  </div>

  <!-- üéÆ Corpo principal -->
  <div class="main-body">
    <!-- üéØ D-Pad -->
    <div class="dpad">
      <button id="up"><img src="images/ic_controller_up_button.png"></button>
      <button id="left"><img src="images/ic_controller_left_button.png"></button>
      <button id="right"><img src="images/ic_controller_right_button.png"></button>
      <button id="down"><img src="images/ic_controller_down_button.png"></button>
    </div>

    <!-- üîò Centro -->
    <div class="center">
      <button id="select" class="btn-system"><i class="fa-solid fa-minus"></i></button>
      <button id="start" class="btn-system">start</button>
      <div class="analogs">
        <button id="l3" class="btn-analog">L3</button>
        <button id="r3" class="btn-analog">R3</button>
      </div>
    </div>

    <!-- üîµ Bot√µes de a√ß√£o -->
    <div class="actions">
      <button id="triangle"><img src="images/ic_controller_triangle_button.png"></button>
      <button id="circle"><img src="images/ic_controller_circle_button.png"></button>
      <button id="cross"><img src="images/ic_controller_cross_button.png"></button>
      <button id="square"><img src="images/ic_controller_square_button.png"></button>
    </div>
  </div>

</div>

  <!-- Modal BIOS/Game -->
  <div class="modal fade" id="settingsModal" tabindex="-1">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content p-3">
      <h5>Selecionar BIOS / Game / Arquivo do Sistema</h5>
      
      <div id="file">
        <label for="file-upload" class="custom-file-upload modal-btn">
          <i class="fas fa-file-upload"></i> Carregar Arquivo
        </label>
        <input id="file-upload" type="file" style="display:none;" />

      </div>

<button id="quality-btn">üéÆ Qualidade: Performance</button>
      <button id="fullscreenBtn" class="modal-btn">
        <i class="fas fa-expand"></i> Tela Cheia
      </button>
<button id="toggleGamepadBtn" class="modal-btn">
  üïπÔ∏è Gamepad Virtual: Ativado
</button>
<div id="biosNotification" class="bios-notification"></div>
    </div>
  </div>
</div>

  <!-- Scripts -->
  <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gpu.js/2.12.0/gpu.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/eruda@3.0.0/eruda.min.js"></script>

  <script>
    if (window.WebGPUShader && typeof window.WebGPUShader.setScale !== "function") {
      window.WebGPUShader.setScale = function(scale = 1.0) {
        console.log("[Fallback] setScale ignorado. Escala:", scale);
      };
    }
    window.FORCE_WEBGL2 = true;
  </script>

  <script src="js/module/biosinject.js"></script>
<script src="js/module/sound.js"></script>
  <script src="js/module/index.js"></script>
 <script src="js/webgl.js"></script>
<script src="js/quality.js"></script>
<script src="https://cdn.jsdelivr.net/npm/js-yaml@4.1.0/dist/js-yaml.min.js"></script>
<script src="dB.js"></script>
  <script src="js/module/virtualpad.js"></script>
  
<script>
  const settingsButton = document.getElementById('settingsButton');
  const settingsModalEl = document.getElementById('settingsModal');

  if (settingsButton && settingsModalEl && window.bootstrap) {
    const modal = new bootstrap.Modal(settingsModalEl);
    settingsButton.addEventListener('click', () => modal.show());
  } else if (settingsButton) {
    settingsButton.addEventListener('click', () => alert('Modal n√£o dispon√≠vel (Bootstrap ausente)'));
  }
</script>

<script>
(() => {
  const btn = document.getElementById('fullscreenBtn');
  if (!btn) return;

  const isFullscreen = () => !!(
    document.fullscreenElement ||
    document.webkitFullscreenElement ||
    document.msFullscreenElement
  );

  const enterFullscreen = () => {
    const elem = document.documentElement; // Toda a p√°gina
    if (elem.requestFullscreen) elem.requestFullscreen();
    else if (elem.webkitRequestFullscreen) elem.webkitRequestFullscreen();
    else if (elem.msRequestFullscreen) elem.msRequestFullscreen();
  };

  const exitFullscreen = () => {
    if (document.exitFullscreen) document.exitFullscreen();
    else if (document.webkitExitFullscreen) document.webkitExitFullscreen();
    else if (document.msExitFullscreen) document.msExitFullscreen();
  };

  const toggleFullscreen = () => {
    if (isFullscreen()) exitFullscreen();
    else enterFullscreen();
  };

  const updateButton = () => {
    btn.textContent = isFullscreen() ? 'Sair do Fullscreen' : 'Entrar em Fullscreen';
  };

  btn.addEventListener('click', toggleFullscreen);
  document.addEventListener('fullscreenchange', updateButton);
  document.addEventListener('webkitfullscreenchange', updateButton);
  document.addEventListener('msfullscreenchange', updateButton);

  // For√ßa canvas ocupar toda tela
  const canvas = document.getElementById('display');
  const resizeCanvas = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  };
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas(); // inicializa

  updateButton();
})();
</script>

<script>
(() => {
  const gamepadBtn = document.getElementById('toggleGamepadBtn');
  const virtualGamepad = document.getElementById('virtualGamepad');

  if (!gamepadBtn || !virtualGamepad) return;

  // Estado inicial carregado do localStorage (ou true se n√£o existir)
  let gamepadActive = localStorage.getItem('gamepadActive');
  gamepadActive = gamepadActive === null ? true : gamepadActive === 'true';

  const updateButtonText = () => {
    gamepadBtn.textContent = `üïπÔ∏è Gamepad Virtual: ${gamepadActive ? 'Ativado' : 'Desativado'}`;
  };

  // Aplica o estado inicial ao gamepad
  virtualGamepad.style.display = gamepadActive ? 'flex' : 'none';
  updateButtonText();

  // Toggle ao clicar
  gamepadBtn.addEventListener('click', () => {
    gamepadActive = !gamepadActive;
    virtualGamepad.style.display = gamepadActive ? 'flex' : 'none';
    updateButtonText();
    localStorage.setItem('gamepadActive', gamepadActive); // salva prefer√™ncia
  });
})();
</script>
</body>
</html>